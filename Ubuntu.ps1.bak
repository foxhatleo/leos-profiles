$vmstatus = (& "C:\Program Files (x86)\VMware\VMware Workstation\vmrun.exe" list) | Out-String
if (-not ($vmstatus -match 'Ubuntu')) {
    Write-Output -InputObject "Starting VM. Please wait."
    & "C:\Program Files (x86)\VMware\VMware Workstation\vmrun.exe" start "D:\VM\Ubuntu\Ubuntu.vmx" nogui
    Write-Output -InputObject "Attempting to connect. If this does not work, it may suggest a connection problem."
    while ($true) {
        ssh -q leoliang@vm.local.leoliang.com exit
        if ($?) {
            break
        }
        Start-Sleep -Seconds 1
    }
    Write-Output -InputObject "Enter the VM password to stop GUI. Ctrl+C to skip this step and leave GUI on."
    ssh -t leoliang@vm.local.leoliang.com "source /home/leoliang/.zshrc; gui-stop"
}
Clear-Host
ssh leoliang@192.168.110.129
